<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Stock Price Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .stocks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .stock-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
        }

        .card-header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .card-header h2 {
            font-size: 1.8rem;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .card-header .company-name {
            font-size: 0.9rem;
            color: #718096;
            font-weight: 500;
        }

        .alert-status {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .alert-status.alert-triggered {
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
            color: white;
            box-shadow: 0 10px 25px rgba(245, 101, 101, 0.4);
        }

        .alert-status.no-alert {
            background: linear-gradient(135deg, #48bb78 0%, #2f855a 100%);
            color: white;
            box-shadow: 0 10px 25px rgba(72, 187, 120, 0.4);
        }

        .alert-status .icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .alert-status .reason {
            font-size: 0.85rem;
            margin-top: 8px;
            opacity: 0.95;
        }

        .price-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .price-card {
            background: #f7fafc;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .price-card .label {
            color: #718096;
            font-size: 0.75rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .price-card .value {
            color: #2d3748;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .drop-percentage {
            background: #edf2f7;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .drop-percentage .label {
            color: #718096;
            font-size: 0.75rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .drop-percentage .value {
            font-size: 2rem;
            font-weight: bold;
        }

        .drop-percentage .value.drop {
            color: #e53e3e;
        }

        .drop-percentage .value.rise {
            color: #38a169;
        }

        .metadata {
            text-align: center;
            color: #a0aec0;
            font-size: 0.85rem;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }

        .metadata div {
            margin-bottom: 5px;
        }

        .metadata strong {
            color: #4a5568;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            padding: 40px;
        }

        .error {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .stocks-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .card-header h2 {
                font-size: 1.5rem;
            }

            .drop-percentage .value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üìà Stock Price Monitor</h1>
            <p>Real-time monitoring of selected stocks</p>
        </div>

        <div id="content">
            <div class="loading">Loading data...</div>
        </div>
    </div>

    <script>
        // Configuration
        // Use ./data to be explicit about relative path
        const DATA_BASE_URL = './data';

        // Company names mapping
        const COMPANY_NAMES = {
            'AAPL': 'Apple Inc.',
            'MSFT': 'Microsoft Corporation',
            'GOOGL': 'Alphabet Inc.'
        };

        async function loadAllStocks() {
            try {
                // Try to load tickers from config, fallback to common ones
                const tickers = ['AAPL', 'MSFT', 'GOOGL'];

                const content = document.getElementById('content');
                const grid = document.createElement('div');
                grid.className = 'stocks-grid';

                let loadedCount = 0;
                let errors = [];

                for (const ticker of tickers) {
                    try {
                        const pricesUrl = `${DATA_BASE_URL}/prices_${ticker}.json`;
                        const alertsUrl = `${DATA_BASE_URL}/alerts_${ticker}.json`;

                        const pricesResponse = await fetch(pricesUrl);
                        const alertsResponse = await fetch(alertsUrl);

                        if (!pricesResponse.ok) {
                            throw new Error(`Prices 404: ${pricesUrl}`);
                        }
                        if (!alertsResponse.ok) {
                            throw new Error(`Alerts 404: ${alertsUrl}`);
                        }

                        const pricesData = await pricesResponse.json();
                        const alertsData = await alertsResponse.json();

                        const card = createStockCard(ticker, pricesData, alertsData);
                        grid.appendChild(card);
                        loadedCount++;

                    } catch (error) {
                        console.error(`Error loading ${ticker}:`, error);
                        errors.push(`${ticker}: ${error.message}`);
                    }
                }

                if (loadedCount === 0) {
                    displayError(`No stock data available. Details:<br>${errors.join('<br>')}`);
                } else {
                    content.innerHTML = '';
                    content.appendChild(grid);
                    if (errors.length > 0) {
                        // Show partial errors if some loaded
                        const errorDiv = document.createElement('div');
                        errorDiv.style.color = 'white';
                        errorDiv.style.textAlign = 'center';
                        errorDiv.style.marginBottom = '20px';
                        errorDiv.innerHTML = `‚ö†Ô∏è Failed to load: ${errors.join(', ')}`;
                        content.insertBefore(errorDiv, grid);
                    }
                }

            } catch (error) {
                displayError(error.message);
            }
        }

        function createStockCard(ticker, pricesData, alertsData) {
            const card = document.createElement('div');
            card.className = 'stock-card';

            const prices = pricesData.prices || [];

            if (prices.length === 0) {
                card.innerHTML = `
                    <div class="card-header">
                        <h2>${ticker}</h2>
                    </div>
                    <div style="text-align: center; color: #a0aec0;">No price data available</div>
                `;
                return card;
            }

            const sortedPrices = [...prices].sort((a, b) => {
                return new Date(a.date) - new Date(b.date);
            });

            const firstPrice = sortedPrices[0].close;
            const lastPrice = sortedPrices[sortedPrices.length - 1].close;
            const dropPercentage = alertsData.drop_percentage || 0;
            const alertTriggered = alertsData.alert_triggered || false;

            const lastUpdate = pricesData.last_fetch_timestamp
                ? new Date(pricesData.last_fetch_timestamp).toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    timeZone: 'UTC',
                    timeZoneName: 'short'
                })
                : 'Unknown';

            card.innerHTML = `
                <div class="card-header">
                    <h2>${ticker}</h2>
                    <div class="company-name">${COMPANY_NAMES[ticker] || ticker}</div>
                </div>
                
                <div class="alert-status ${alertTriggered ? 'alert-triggered' : 'no-alert'}">
                    <div class="icon">${alertTriggered ? 'üî¥' : 'üü¢'}</div>
                    <div>${alertTriggered ? 'ALERT TRIGGERED' : 'NO ALERT'}</div>
                    <div class="reason">${alertsData.reason || ''}</div>
                </div>
                
                <div class="price-grid">
                    <div class="price-card">
                        <div class="label">5 Days Ago</div>
                        <div class="value">$${firstPrice.toFixed(2)}</div>
                    </div>
                    <div class="price-card">
                        <div class="label">Latest Close</div>
                        <div class="value">$${lastPrice.toFixed(2)}</div>
                    </div>
                </div>
                
                <div class="drop-percentage">
                    <div class="label">Price Change (5 Days)</div>
                    <div class="value ${dropPercentage >= 0 ? 'drop' : 'rise'}">
                        ${dropPercentage >= 0 ? '‚ñº' : '‚ñ≤'} ${Math.abs(dropPercentage).toFixed(2)}%
                    </div>
                </div>

                <!-- SEC Filing Context -->
                ${alertsData.filing_context && alertsData.filing_context.length > 0 ? `
                    <div class="filing-context">
                        <h4>üìÑ Related SEC Filings</h4>
                        <ul>
                            ${alertsData.filing_context.slice(0, 3).map(filing => `
                                <li>
                                    <a href="${filing.url}" target="_blank" style="color: #4a5568; text-decoration: none;">
                                        ${filing.form_type}: ${filing.key_points.join(', ') || 'No details'}
                                    </a>
                                    <span class="relevance" style="font-size: 0.8rem; color: #666;">
                                        ${filing.relevance_score > 0.7 ? 'üî¥ Likely related' : 'üü° Possibly related'}
                                    </span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                ` : ''}

                <div class="metadata">
                    <div><strong>Last updated:</strong> ${lastUpdate}</div>
                    <div><strong>Data points:</strong> ${prices.length}</div>
                    ${alertTriggered ? `
                        <div style="margin-top: 10px; color: #e53e3e; font-weight: bold;">
                            ‚ö†Ô∏è Price dropped ${dropPercentage.toFixed(2)}% (threshold: 5%)
                        </div>
                    ` : ''}
                </div>
            `;

            return card;
        }

        function displayError(message) {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="error">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div><strong>Error:</strong> ${message}</div>
                    <div style="margin-top: 10px; font-size: 0.9rem;">
                        Please ensure price and alert data files are available.
                    </div>
                </div>
            `;
        }

        // Load data on page load
        loadAllStocks();

        // Refresh data every 5 minutes
        setInterval(loadAllStocks, 5 * 60 * 1000);
    </script>
</body>

</html>